"use strict";angular.module("mpqPartyPlannerApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngMaterial"]),angular.module("mpqPartyPlannerApp").controller("MainCtrl",["$scope","$http","$location",function(a,b,c){a.mpqModel={characters:[],selectedCharacters:[],teamActiveAbilities:{},teamActiveColors:[],sortPredicate:"rank"},a.colors=["yellow","red","blue","purple","green","black"];var d=function(a){return angular.isDefined(a.name)?a.name.concat(",",a.stars):""},e=function(){var b=_.flatten(_.map(a.mpqModel.selectedCharacters,function(a){return a.abilities}));return _.groupBy(_.filter(b,function(a){return 0!==a.cost}),function(a){return a.color.toLowerCase()})},f=function(){a.mpqModel.teamActiveAbilities=e(),a.mpqModel.teamActiveColors=_.keys(a.mpqModel.teamActiveAbilities)};a.isActive=function(b){var c=-1!==a.mpqModel.teamActiveColors.indexOf(b.toLowerCase());return c},a.isIneligible=function(b){if(-1!==a.mpqModel.selectedCharacters.indexOf(b))return!1;var c=_.every(b.abilities,function(b){var c=0===b.cost||-1!==a.mpqModel.teamActiveColors.indexOf(b.color.toLowerCase());return c});return c},a.isCandidate=function(b){if(-1!==a.mpqModel.selectedCharacters.indexOf(b)||a.mpqModel.selectedCharacters.length>2)return!1;var c=_.map(_.filter(b.abilities,function(a){return 0!==a.cost}),function(a){return a.color.toLowerCase()}),d=_.union(c,a.mpqModel.teamActiveColors);if(d.length>=6)return!0;if(a.mpqModel.selectedCharacters.length<2){var e=_.every(b.abilities,function(b){var c=0===b.cost||-1===a.mpqModel.teamActiveColors.indexOf(b.color.toLowerCase());return c});return e}return!1},a.sortBy=function(b){a.mpqModel.sortPredicate=b},b.get("data/characters.json").success(function(b){a.mpqModel.characters=b;var e=c.search().selection||[];a.mpqModel.selectedCharacters=_.filter(a.mpqModel.characters,function(a){var b=d(a);return""!==a.name&&-1!==e.indexOf(b)?!0:!1}),f()}),a.select=function(b){var e=a.mpqModel.selectedCharacters.indexOf(b);e>-1?a.mpqModel.selectedCharacters.splice(e,1):a.mpqModel.selectedCharacters.length<3&&a.mpqModel.selectedCharacters.push(b);var g=_.map(a.mpqModel.selectedCharacters,function(a){return d(a)});c.search({selection:g}),f()},a.clearSelection=function(){a.mpqModel.selectedCharacters=[],c.search("selection",null),f()},a.isSelectedCharacter=function(b){return a.mpqModel.selectedCharacters.indexOf(b)>-1},a.isSelectedCharacterName=function(b){return-1!==a.mpqModel.selectedCharacters.indexOf(b)?!1:!_.every(a.mpqModel.selectedCharacters,function(a){var c=a.name!==b.name;return c})};var g={yellow:"images/YellowTile.82c1b383.png",red:"images/RedTile.1bbd4cea.png",blue:"images/BlueTile.1776553c.png",purple:"images/PurpleTile.cb847cf6.png",green:"images/GreenTile.334c6a53.png",black:"images/BlackTile.cf6fa774.png"};a.getTileImage=function(a){return g[a]};var h={yellow:"images/YellowFlag.c61f7280.png",red:"images/RedFlag.cf95e17c.png",blue:"images/BlueFlag.0fdc5c37.png",purple:"images/PurpleFlag.58acc4cb.png",green:"images/GreenFlag.d98a5fa0.png",black:"images/BlackFlag.ec7dd1b4.png"};a.getFlagImage=function(a){return h[a]}}]);